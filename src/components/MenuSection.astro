---
import Reveal from "./Reveal.astro";

interface Props {
  title: string;
  imageSrc: string;
  delayClass?: string;
}

const { title, imageSrc, delayClass = "" } = Astro.props as Props;
---

<Reveal delayClass={delayClass}>
  <div class="menu-section border rounded-xl overflow-hidden shadow-sm">
    <button
      type="button"
      class="menu-toggle w-full flex justify-between items-center p-4 text-left 
              transition"
      aria-expanded="false"
    >
      <h3 class="text-2xl font-semibold text-palette-1">{title}</h3>

      <svg
        class="icon w-6 h-6 transition-transform duration-300"
        fill="none" stroke="currentColor" stroke-width="2"
        viewBox="0 0 24 24"
        aria-hidden="true"
      >
        <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
      </svg>
    </button>

    <div class="menu-content overflow-hidden transition-all duration-500 ease-in-out 
                max-h-0">
      <img
        src={imageSrc}
        alt={title}
        class="w-full block max-h-screen object-contain select-none"
        loading="lazy"
      />
    </div>
  </div>
</Reveal>

<script>
  const menuToggles = document.querySelectorAll<HTMLButtonElement>('.menu-toggle');

  menuToggles.forEach((toggle) => {
    const content = toggle.nextElementSibling as HTMLElement;

    toggle.addEventListener('click', () => {
      const isOpen = content.style.maxHeight && content.style.maxHeight !== "0px";

      if (isOpen) {
        // Closing animation
        const currentHeight = content.scrollHeight;
        content.style.maxHeight = currentHeight + "px"; // Set current height before collapsing
        requestAnimationFrame(() => {
          content.style.maxHeight = "0px";
        });
      } else {
        // Opening animation
        content.style.maxHeight = content.scrollHeight + "px";
      }

      toggle.querySelector<SVGSVGElement>('.icon')?.classList.toggle('rotate-180', !isOpen);
    });

    // Optional: reset maxHeight after opening to allow responsive content
    content.addEventListener('transitionend', () => {
      if (content.style.maxHeight !== "0px") {
        content.style.maxHeight = "none";
      }
    });
  });
</script>

